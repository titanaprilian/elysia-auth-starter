import { Elysia } from "elysia";

import { {{capitalize name}}Service } from "./service";
import { {{capitalize name}}Model } from "./model";
import { Create{{capitalize name}}Schema, Update{{capitalize name}}Schema } from "./schema";
import { {{capitalize name}}ParamModel } from "./params";
import { errorResponse, successResponse } from "@/libs/response";

export const {{lowercase name}} = new Elysia({
  prefix: "/{{lowercase name}}s",
  tags: ["{{capitalize name}}"],
})
  .onError(({ code, set, error }) => {
    if (code === "VALIDATION") {
      return errorResponse(set, 400, "Bad Request", {
        issues: error.all,
      });
    }
  })
  .get(
    "/",
    async ({ set }) => {
      const data = await {{capitalize name}}Service.get{{capitalize name}}s();
      return successResponse(set, data, "{{capitalize name}}s retrieved successfully");
    },
    {
      response: {
        200: {{capitalize name}}Model.{{lowercase name}}s,
        500: {{capitalize name}}Model.error,
      },
    }
  )
  .post(
    "/",
    async ({ body, set }) => {
      const data = await {{capitalize name}}Service.create{{capitalize name}}(body);
      return successResponse(set, data, "{{capitalize name}} Succesfully Created", 201);
    },
    {
      body: Create{{capitalize name}}Schema,
      response: {
        201: {{capitalize name}}Model.{{lowercase name}},
        400: {{capitalize name}}Model.validationError,
        500: {{capitalize name}}Model.error,
      },
    }
  )
  .get(
    "/:id",
    async ({ params, set }) => {
      const data = await {{capitalize name}}Service.get{{capitalize name}}(params.id);
      
      if (!data) {
        return errorResponse(set, 404, "{{capitalize name}} Not Found");
      }

      return successResponse(set, data, "{{capitalize name}} details retrieved", 200);
    },
    {
      params: {{capitalize name}}ParamModel,
      response: {
        200: {{capitalize name}}Model.{{lowercase name}},
        404: {{capitalize name}}Model.error,
        500: {{capitalize name}}Model.error,
      },
    }
  )
  .put(
    "/:id",
    async ({ params, body, set }) => {
      try {
        const updatedData = await {{capitalize name}}Service.update{{capitalize name}}(params.id, body);
        return successResponse(
          set,
          updatedData,
          "{{capitalize name}} updated successfully",
          200
        );
      } catch (error) {
        return errorResponse(set, 404, "{{capitalize name}} Not Found");
      }
    },
    {
      params: {{capitalize name}}ParamModel,
      body: Update{{capitalize name}}Schema,
      response: {
        200: {{capitalize name}}Model.{{lowercase name}},
        400: {{capitalize name}}Model.validationError,
        404: {{capitalize name}}Model.error,
        500: {{capitalize name}}Model.error,
      },
    }
  )
  .delete(
    "/:id",
    async ({ params, set }) => {
      try {
        await {{capitalize name}}Service.delete{{capitalize name}}(params.id);

        return successResponse(
            set, 
            { id: params.id }, 
            "{{capitalize name}} Successfully Deleted"
        );
      } catch (error) {
        return errorResponse(set, 404, "{{capitalize name}} Not Found");
      }
    },
    {
      params: {{capitalize name}}ParamModel,
      response: {
        200: {{capitalize name}}Model.deleteResult,
        404: {{capitalize name}}Model.error,
        500: {{capitalize name}}Model.error,
      },
    }
  );
